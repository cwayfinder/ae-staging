class e{constructor(e){this.repo=e,this.resistance={terra:1,road:1,bridge:1,hill:2,forest:2,stone:3,water:3}}init(){this.terrain=this.setTerrainType(this.repo.getTerrains());const e=this.repo.getBattle().size;this.bounds={minX:0,minY:0,maxX:e.width-1,maxY:e.height-1}}setTerrainType(e){const t={};for(const[s,i]of Object.entries(e))t[s]=i.replace(/\-\d+$/,"");return t}getReachableCells({start:e,range:t,moveType:s,obstacles:i=[]}){const n=[],r=[],a=({x:e,y:t},i)=>{const n=this.terrain[`x${e}y${t}`],r=this.getPathResistance(n,s);i>=r&&o({x:e,y:t},i-r)},o=({x:e,y:t},s)=>{n.some((i=>i.x===e&&i.y===t&&i.distance>=s))||(n.push({x:e,y:t,distance:s}),r.some((s=>s.x===e&&s.y===t))||r.push({x:e,y:t}),this.getSiblingCells({x:e,y:t}).filter((({x:e,y:t})=>!i.includes(`x${e}y${t}`))).forEach((e=>a(e,s))))};return o(e,t-1),r.shift(),r}getSiblingCells({x:e,y:t}){return[{x:e-1,y:t},{x:e+1,y:t},{x:e,y:t-1},{x:e,y:t+1}].filter((e=>this.isCellInBounds(e)))}isCellInBounds({x:e,y:t}){return e<=this.bounds.maxX&&e>=this.bounds.minX&&t<=this.bounds.maxY&&t>=this.bounds.minY}getPathResistance(e,t){switch(t){case"walk":return this.resistance[e];case"flow":return"water"===e?1:this.resistance[e];default:return 1}}}window.PathFinder=e,window.pathFinder=new e(window.battleRepository);
